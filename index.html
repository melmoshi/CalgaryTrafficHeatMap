<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title></title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.43.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.43.0/mapbox-gl.css' rel='stylesheet' />
    <link rel="stylesheet" href="main.css">
    <style>
      body {
        margin: 0;
        padding: 0;
      }

      #map {
        position: absolute;
        top: 0;
        bottom: 0;
        width: 100%;
      }
    </style>
</head>
    
    
    
<body>
    
  <div id='map'></div> 
    
       <div class='map-overlay' id='features'>
            <h2 id="yearTitle">Traffic Incidents 2017</h2>
            <div id='pd'>
                <p>Zoom-in to see individual points, and click to see number of incidents. <br /> <br /> This is a work in progress.</p>
            </div>
        </div>
        
<!--
        <div class='map-overlay' id='legend'> 
        <P id='rate'><strong>Traffic Incidents 2017</strong></P>
        </div>
-->
        
        <div class='map-overlay' id='info'>
            <P>Moshi - 2018</P>
            <P>data.calgary.ca</P>
            <P>Traffic Heat Map</P>  
            <a id="mapsLink" href="https://melmoshi.github.io" target="_blank"><strong>View More Maps</strong></a>
        </div>
        
    
    
  <script>
    mapboxgl.accessToken = 'pk.eyJ1IjoibWVsYW5pZW1vc2hpIiwiYSI6ImNqY3kwMTRncTA5OHAzM3A3YmZwd3J5ZG8ifQ._EtJnUNns23JnKcKiI0xGw';
    var map = new mapboxgl.Map({
      container: 'map',
      style: 'mapbox://styles/melaniemoshi/cjcusi5vz2b5l2rr3r2c365xg',
      center: [-114.0708, 51.0486],
      zoom: 10.7
    });

           map.on('load', function() {

               // ---------add source---------------------------------------------------------
          map.addSource('traffic', {
            type: 'geojson',
            data: './trafficWithCount2.geojson'
          });
               
               
               
          // --------------add heatmap layer here----------------------------------------------
               map.addLayer({
                  id: 'traffic-heat',
                  type: 'heatmap',
                  source: 'traffic',
                  maxzoom: 20,
                  paint: {
                      
                    // increase weight as diameter breast height increases
                    'heatmap-weight': {
                      property: 'COUNT_1',
                      stops: [
                        [1, 1],     // when count = 1, heatmap-weight is 1
                      ]
                    },
                      
                    // increase intensity as zoom level increases
                    'heatmap-intensity': {
                      stops: [
                        [11, 1],
                        [15, 3]
                      ]
                    },
                      
                    // assign color values be applied to points depending on their density
                    'heatmap-color': [
                      'interpolate',
                      ['linear'],
                      ['heatmap-density'],
                      0, 'rgba(100,239,139,0)',
                      0.2, 'rgb(26,150,65)',
                      0.4, 'rgb(166,217,106)',
                      0.8, 'rgb(253,174,97)',
                      0.95, 'rgb(252,141,89)',
                      1, 'rgb(215,25,28)'
                    ],
                      
                    // increase radius as zoom increases
                    'heatmap-radius': {
                      stops: [
                        [11, 17],  //At zoom level __, radius is at __
                        [15, 40]   //At zoom level __, radius is at __
                      ]
                    },
                      
                    // decrease opacity to transition into the circle layer
                    'heatmap-opacity': {
                      default: 0.8,  //Default opacity is 1
                      stops: [
                        [10, 0.6],  //At zoom level __, opacity is at __
                        [14, 0.3],
                        [17, 0.2]
                      ]
                    },
                  }
                }, 'waterway-label');
               
               
               
          // ---------------add circle layer here----------------------------------------
               map.addLayer({
                  id: 'traffic-point',
                  type: 'circle',
                  source: 'traffic',
                  minzoom: 13,
                  paint: {
                    // increase the radius of the circle as the zoom level and dbh value increases
                    'circle-radius': {
                      property: 'COUNT_1',
                      type: 'exponential',
                      stops: [
                        [{ zoom: 13, value: 1 }, 5],
                        [{ zoom: 13, value: 45 }, 10],
                        [{ zoom: 17, value: 1 }, 20],
                        [{ zoom: 17, value: 45 }, 50],
                      ]
                    },
                    'circle-color': {
                          property: 'COUNT_1',
                          type: 'exponential',
                          stops: [
                            [0, 'rgba(236,222,239,0)'],
                            [1, 'rgb(255,56,56)'],
                            [2, 'rgb(229,45,45)'],
                            [4, 'rgb(205,34,34)'],
                            [8, 'rgb(178,23,23)'],
                            [25,'rgb(152,12,12)'],
                            [110, 'rgb(127,1,1)']
                          ]
                        },    /* IF THERE ARE ERRORS, CHECK COLOR^^ (DONE BY HAND) */
                    'circle-opacity': {
                      stops: [
                        [12, 0],
                        [13, 1]
                      ]
                    }
                  }
                }, 'waterway-label');
                        });
      
      // ---------------add circle interactivity----------------------------------------
      
      map.on('click', 'traffic-point', function(e) {
              new mapboxgl.Popup()
                .setLngLat(e.features[0].geometry.coordinates)
                .setHTML('<b>Count:</b> ' + e.features[0].properties.COUNT_1)
                .addTo(map);
            });
      //------------------------------------------------------------------------------

  </script>
    
</body> 
    
</html>